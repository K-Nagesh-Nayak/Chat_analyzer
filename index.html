<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WhatsApp Chat Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #fef9f9; }
    h1 { color: #d63384; }
    .section { margin-top: 20px; }
    .chart-container { width: 100%; max-width: 600px; margin-top: 20px; }
  </style>
</head>
<body>

<h1>ðŸ“± WhatsApp Chat Analyzer</h1>

<input type="file" id="fileInput" accept=".txt" />
<button onclick="analyzeChat()">Analyze</button>

<div id="output" class="section"></div>
<canvas id="wordChart" class="chart-container"></canvas>
<canvas id="emojiChart" class="chart-container"></canvas>

<script>


function analyzeChat() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("Please select a file.");

  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split("\n");
    const wordFreq = {};
    const emojiFreq = {};
    const userStats = {};
    const messageData = [];

    const emojiRegex = /[\u{1F300}-\u{1FAFF}]/gu;
    const chatLine = /^(\d{1,2})\/(\d{1,2})\/(\d{2,4}), (\d{1,2}):(\d{2})\s?(AM|PM|am|pm)? - (.*?): (.*)$/;

    for (let line of lines) {
      const match = line.match(chatLine);
      if (!match) continue;

      const day = match[1], month = match[2], year = match[3];
      const hour = parseInt(match[4]), minute = parseInt(match[5]);
      const meridian = match[6] || '';
      const sender = match[7], message = match[8];

      if (message.toLowerCase().includes("omitted")) continue;

      let hour24 = hour;
      if (meridian.toLowerCase() === 'pm' && hour < 12) hour24 += 12;
      if (meridian.toLowerCase() === 'am' && hour === 12) hour24 = 0;

      const fullYear = year.length === 2 ? `20${year}` : year;
      const timestamp = new Date(`${fullYear}-${month}-${day}T${String(hour24).padStart(2, '0')}:${String(minute).padStart(2, '0')}:00`);

      messageData.push({ sender, message, timestamp });

      // Word count
      const words = message.toLowerCase().match(/\b\w+\b/g) || [];
      for (const w of words) wordFreq[w] = (wordFreq[w] || 0) + 1;

      // Emoji count
      const emojis = message.match(emojiRegex) || [];
      for (const e of emojis) emojiFreq[e] = (emojiFreq[e] || 0) + 1;

      // User count
      userStats[sender] = userStats[sender] || { count: 0, responseTimes: [] };
      userStats[sender].count++;
    }

    // Calculate response time per user
    for (let i = 1; i < messageData.length; i++) {
      const prev = messageData[i - 1];
      const curr = messageData[i];
      if (curr.sender !== prev.sender) {
        const diffSec = (curr.timestamp - prev.timestamp) / 1000;
        if (diffSec > 5 && diffSec < 7200) {
          userStats[curr.sender].responseTimes.push(diffSec);
        }
      }
    }

    // Generate Output
    const output = document.getElementById("output");
    let html = `<h2>ðŸ“Š Top Words</h2><ul>`;
    const topWords = Object.entries(wordFreq).sort((a, b) => b[1] - a[1]).slice(0, 10);
    topWords.forEach(([word, count]) => html += `<li>${word}: ${count}</li>`);
    html += `</ul><h2>ðŸ˜‚ Emoji Stats</h2><ul>`;
    const topEmojis = Object.entries(emojiFreq).sort((a, b) => b[1] - a[1]).slice(0, 10);
    topEmojis.forEach(([emoji, count]) => html += `<li>${emoji}: ${count}</li>`);
    html += `</ul><h2>ðŸ‘¤ User Stats</h2><ul>`;
    for (const user in userStats) {
      const avgResp = userStats[user].responseTimes.length
        ? (userStats[user].responseTimes.reduce((a,b)=>a+b)/userStats[user].responseTimes.length).toFixed(2)
        : "N/A";
      html += `<li><strong>${user}</strong>: ${userStats[user].count} messages, Avg Response Time: ${avgResp}s</li>`;
    }
    html += `</ul>`;
    output.innerHTML = html;

    // Chart: Top Words
    const wordCtx = document.getElementById("wordChart").getContext("2d");
    new Chart(wordCtx, {
      type: "bar",
      data: {
        labels: topWords.map(w => w[0]),
        datasets: [{ label: "Top Words", data: topWords.map(w => w[1]), backgroundColor: "#d63384" }]
      }
    });

    // Chart: Top Emojis
    const emojiCtx = document.getElementById("emojiChart").getContext("2d");
    new Chart(emojiCtx, {
      type: "bar",
      data: {
        labels: topEmojis.map(e => e[0]),
        datasets: [{ label: "Top Emojis", data: topEmojis.map(e => e[1]), backgroundColor: "#6f42c1" }]
      }
    });
  };
  reader.readAsText(file);
}


</script>

</body>
</html>
